r"""<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Formul√°rio ‚Äì Atendimento Jur√≠dico Especializado</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#0f1222; --card:#171a2e; --ink:#e9ecff; --muted:#a9b0d6;
      --pri:#6c8cff; --pri-ink:#0a0e2b; --warn:#ffd166; --border:#2a2e4b;
      --accent:#b8c6ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.5}
    .wrap{max-width:980px;margin:24px auto;padding:0 16px}
    /* HEADER */
    .hero{background:linear-gradient(180deg,#1c203d,#12152a);border:1px solid var(--border);border-radius:16px;padding:18px 18px 22px;margin-bottom:18px}
    .brand{display:flex;flex-direction:column;align-items:center;gap:10px}
    .brand img{max-width:260px;width:100%;height:auto;display:inline-block;object-fit:contain;filter:drop-shadow(0 2px 2px rgba(0,0,0,.3))}
    .brand h1{margin:0 0 6px;font-weight:800;letter-spacing:.8px;text-align:center}
    .oabs{font-size:.82rem;color:var(--muted);margin-top:8px;text-align:right}
    .subtitle{margin:.35rem 0 0;color:#fff;font-weight:700;text-align:center;font-size:1.08rem}

    /* CARDS */
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;margin:14px 0}
    .grid{display:grid;gap:12px}
    @media (min-width:720px){ .grid.cols-2{grid-template-columns:1fr 1fr} }
    label{display:block;font-size:.88rem;color:var(--muted);margin:4px 0 6px}
    input,select,textarea{width:100%;background:#0f1330;color:var(--ink);border:1px solid var(--border);border-radius:10px;padding:12px 12px;outline:none}
    textarea{min-height:96px;resize:vertical}
    .section-title{margin:0 0 8px;font-weight:700;font-size:1.06rem}
    .hide{display:none}
    .btns{display:flex;gap:12px;flex-wrap:wrap}
    .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;background:var(--pri);color:var(--pri-ink)}
    .req::after{content:" *";color:var(--warn);font-weight:700}
    .callout{background:#13273a;border:1px solid #1b3953;padding:12px 14px;border-radius:12px;margin-top:16px}
    a{color:var(--accent);text-decoration:none}
    footer{text-align:center;margin:30px 0 20px;color:var(--muted);font-size:.85rem}
    .pill{display:inline-block;padding:8px 12px;border:1px solid var(--border);border-radius:999px;margin:4px 6px 0 0}
    .pill input{margin-right:8px;vertical-align:middle}
    .err{color:#ff6b6b;font-size:.9rem;display:none}
    .inline{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .chips{display:flex;gap:10px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);padding:8px 10px;border-radius:10px}
    hr.sep{border:0;border-top:1px dashed var(--border);margin:14px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- HEADER -->
    <section class="hero" aria-label="Identidade">
      <div class="brand">
        <img src="logo-juliano-garbuggio.png" alt="Logo Juliano Garbuggio">
        <h1>JULIANO GARBUGGIO | ADVOCACIA &amp; CONSULTORIA</h1>
      </div>
      <div class="oabs">OAB/SP 505.598 &nbsp;|&nbsp; OAB/PR 47.565 &nbsp;|&nbsp; OAB/MG 234.362</div>
      <p class="subtitle">Preencha seus dados para atendimento especializado.</p>
    </section>

    <form id="form" novalidate>
      <!-- CONTEXTO -->
      <section class="card">
        <h2 class="section-title">1) Contexto do Atendimento</h2>
        <div class="grid cols-2">
          <div>
            <label class="req" for="motivo">Motivo do atendimento</label>
            <select id="motivo" required>
              <option value="">Selecione‚Ä¶</option>
              <option value="revisao">Revis√£o de empr√©stimos</option>
              <option value="atualizacao">ATUALIZA√á√ÉO DE CADASTRO</option>
              <option value="procuracao">PROCURA√á√ÉO</option>
              <option value="duvida">D√∫vida geral</option>
              <option value="outros">Outros</option>
            </select>
          </div>
          <div id="tipo_wrap">
            <label class="req">Tipo de contato</label>
            <div>
              <label class="pill"><input type="radio" name="tipo" value="Consignado INSS" required> Consignado INSS</label>
              <label class="pill"><input type="radio" name="tipo" value="Consignado p√∫blico/privado"> Consignado p√∫blico/privado</label>
              <label class="pill"><input type="radio" name="tipo" value="Financiamento banc√°rio"> Financiamento banc√°rio</label>
              <label class="pill"><input type="radio" name="tipo" value="Direito Digital"> Direito Digital</label>
              <label class="pill"><input type="radio" name="tipo" value="Direito M√©dico"> Direito M√©dico</label>
              <label class="pill"><input type="radio" name="tipo" value="Outros casos Direito Consumidor | Civil"> Outros casos Direito Consumidor | Civil</label>
              <label class="pill"><input type="radio" name="tipo" value="D√∫vida geral"> D√∫vida geral</label>
            </div>
          </div>
        </div>
      </section>

      <!-- DADOS SIMPLES (TODOS os demais casos) -->
      <section class="card" id="sec-simples">
        <h2 class="section-title">2) Dados para contato</h2>
        <div class="grid cols-2">
          <div><label class="req" for="nome_s">Nome completo</label><input id="nome_s" required></div>
          <div><label class="req" for="cpf_s">CPF</label><input id="cpf_s" placeholder="000.000.000-00" required></div>

          <!-- Identifica√ß√£o complementar (opcional) ‚Äì SIMPLES -->
          <div style="grid-column:1/-1">
            <label>Identifica√ß√£o complementar (opcional)</label>
            <div class="inline">
              <label class="pill"><input type="radio" name="ident_comp_s" value="sim"> Sim</label>
              <label class="pill"><input type="radio" name="ident_comp_s" value="nao" checked> N√£o</label>
            </div>
          </div>
          <div id="ident-comp-bloco-s" class="hide" style="grid-column:1/-1">
            <div class="grid cols-2">
              <div><label for="nome_social_s">Nome social</label><input id="nome_social_s" placeholder="Opcional"></div>
              <div><label for="pronomes_s">Pronomes (ex.: ela/dela, ele/dele, elu/delu)</label><input id="pronomes_s" placeholder="Opcional"></div>
            </div>
            <hr class="sep">
          </div>

          <!-- Identidade de g√™nero (opcional) ‚Äì SIMPLES -->
          <div style="grid-column:1/-1">
            <label>Auto Declara√ß√£o ‚Äì Identidade de G√™nero (opcional)</label>
            <div class="inline">
              <label class="pill"><input type="radio" name="ident_genero_toggle_s" value="sim"> Sim</label>
              <label class="pill"><input type="radio" name="ident_genero_toggle_s" value="nao" checked> N√£o</label>
            </div>
            <div id="genero-opcoes-s" class="hide" style="margin-top:10px">
              <div class="chips">
                <label class="chip"><input type="checkbox" value="Mulher cisg√™nera"> Mulher cisg√™nera</label>
                <label class="chip"><input type="checkbox" value="Homem cisg√™nero"> Homem cisg√™nero</label>
                <label class="chip"><input type="checkbox" value="Mulher transg√™nera"> Mulher transg√™nera</label>
                <label class="chip"><input type="checkbox" value="Homem transg√™nero"> Homem transg√™nero</label>
                <label class="chip"><input type="checkbox" value="Travesti"> Travesti</label>
                <label class="chip"><input type="checkbox" value="N√£o-bin√°rie"> N√£o-bin√°rie</label>
                <label class="chip"><input type="checkbox" value="Prefiro n√£o dizer"> Prefiro n√£o dizer</label>
                <label class="chip">Outro: <input id="genero_outro_s" placeholder="especifique" style="width:220px"></label>
              </div>
            </div>
          </div>

          <div><label class="req" for="cel_s">Celular (WhatsApp)</label><input id="cel_s" placeholder="(11) 9xxxx-xxxx" required></div>
          <div><label for="email_s">E-mail</label><input id="email_s" type="email" placeholder="voce@email.com"></div>
          <div><label class="req" for="cep_s">CEP</label><input id="cep_s" placeholder="00000-000" required></div>
          <div><label class="req" for="cidadeuf_s">Cidade/UF</label><input id="cidadeuf_s" placeholder="Cidade/UF" required></div>
          <div class="cols-2" style="grid-column:1/-1">
            <label for="breve">Relate brevemente o motivo do contato</label>
            <textarea id="breve" placeholder="Ex.: cobran√ßa indevida, d√∫vida sobre contrato, etc."></textarea>
          </div>
        </div>
      </section>

      <!-- DADOS COMPLETOS (Procura√ß√£o/Atualiza√ß√£o) -->
      <section class="card hide" id="sec-completo">
        <h2 class="section-title">2) Dados pessoais</h2>
        <div class="grid cols-2">
          <div><label class="req" for="nome">Nome completo</label><input id="nome"></div>

          <!-- Identifica√ß√£o complementar (opcional) ‚Äì COMPLETO -->
          <div style="grid-column:1/-1">
            <label>Identifica√ß√£o complementar (opcional)</label>
            <div class="inline">
              <label class="pill"><input type="radio" name="ident_comp" value="sim"> Sim</label>
              <label class="pill"><input type="radio" name="ident_comp" value="nao" checked> N√£o</label>
            </div>
          </div>
          <div id="ident-comp-bloco" class="hide" style="grid-column:1/-1">
            <div class="grid cols-2">
              <div><label for="nome_social">Nome social</label><input id="nome_social" placeholder="Opcional"></div>
              <div><label for="pronomes">Pronomes (ex.: ela/dela, ele/dele, elu/delu)</label><input id="pronomes" placeholder="Opcional"></div>
            </div>
            <hr class="sep">
          </div>

          <div>
            <label class="req" for="nacionalidade">Nacionalidade</label>
            <select id="nacionalidade">
              <option>Brasileiro(a)</option>
              <option>Outros</option>
            </select>
          </div>
          <div id="nac_outros_wrap" class="hide"><label for="nac_outros">Qual?</label><input id="nac_outros"></div>

          <div><label class="req" for="nasc">Data de nascimento (dd/mm/aaaa)</label><input id="nasc" placeholder="dd/mm/aaaa" inputmode="numeric" maxlength="10"></div>

          <div>
            <label class="req" for="ec">Estado civil</label>
            <select id="ec">
              <option value="">Selecione‚Ä¶</option>
              <option>Solteira(o)</option>
              <option>Casada(o)</option>
              <option>Uni√£o est√°vel</option>
              <option>Divorciada(o)</option>
              <option>Vi√∫va(o)</option>
            </select>
          </div>

          <div>
            <label class="req" for="prof">Profiss√£o</label>
            <select id="prof">
              <option value="">Selecione a profiss√£o</option>
              <optgroup label="√Årea Administrativa e Financeira">
                <option>Administrador</option><option>Assistente Administrativo</option><option>Secret√°rio(a)</option><option>Contador</option><option>Analista Financeiro</option><option>Gestor de RH</option><option>Auxiliar de Escrit√≥rio</option><option>Recepcionista</option><option>Office Boy / Mensageiro</option><option>Economista</option><option>Funcion√°rio P√∫blico</option>
              </optgroup>
              <optgroup label="√Årea T√©cnica e Industrial">
                <option>Engenheiro Civil</option><option>Engenheiro El√©trico</option><option>T√©cnico em Edifica√ß√µes</option><option>T√©cnico em Mec√¢nica</option><option>T√©cnico em Eletr√¥nica</option><option>Mec√¢nico</option><option>Eletricista</option><option>Encanador</option><option>Operador de M√°quinas</option><option>Soldador</option>
              </optgroup>
              <optgroup label="Com√©rcio e Servi√ßos">
                <option>Comerciante</option><option>Vendedor</option><option>Representante Comercial</option><option>Caixa</option><option>Supervisor de Vendas</option><option>Gar√ßom / Gar√ßonete</option><option>Balconista</option><option>Atendente</option><option>Motorista</option><option>Entregador</option>
              </optgroup>
              <optgroup label="Sa√∫de e Bem-Estar">
                <option>M√©dico</option><option>Enfermeiro</option><option>T√©cnico de Enfermagem</option><option>Dentista</option><option>Fisioterapeuta</option><option>Psic√≥logo</option><option>Nutricionista</option><option>Farmac√™utico</option><option>Cuidador de Idosos</option><option>Esteticista</option><option>Biom√©dico</option>
              </optgroup>
              <optgroup label="Educa√ß√£o e Cultura">
                <option>Professor</option><option>Pedagogo</option><option>Bibliotec√°rio</option><option>Coordenador Escolar</option><option>Instrutor / Educador Social</option><option>Tradutor / Int√©rprete</option>
              </optgroup>
              <optgroup label="Constru√ß√£o Civil">
                <option>Pedreiro</option><option>Servente</option><option>Mestre de Obras</option><option>Pintor</option><option>Carpinteiro</option><option>Azulejista</option><option>Jardineiro</option>
              </optgroup>
              <optgroup label="Tecnologia da Informa√ß√£o">
                <option>Analista de Sistemas</option><option>Desenvolvedor</option><option>Programador</option><option>Suporte T√©cnico</option><option>T√©cnico de Inform√°tica</option><option>Designer Gr√°fico</option><option>Analista de Dados</option>
              </optgroup>
              <optgroup label="Jur√≠dico e Cont√°bil">
                <option>Advogado</option><option>Estagi√°rio de Direito</option><option>T√©cnico Cont√°bil</option><option>Perito</option><option>Consultor Jur√≠dico</option>
              </optgroup>
              <optgroup label="Beleza, Moda e Est√©tica">
                <option>Cabeleireiro</option><option>Manicure / Pedicure</option><option>Maquiador</option><option>Costureiro</option><option>Designer de Sobrancelhas</option><option>Consultor de Moda</option>
              </optgroup>
              <optgroup label="Seguran√ßa e Transporte">
                <option>Policial</option><option>Bombeiro</option><option>Vigilante</option><option>Seguran√ßa Patrimonial</option><option>Motorista Particular</option><option>Motoboy</option>
              </optgroup>
              <optgroup label="Agricultura e Campo">
                <option>Agricultor</option><option>Pecuarista</option><option>Trabalhador Rural</option><option>Pescador</option><option>Jardineiro</option>
              </optgroup>
              <optgroup label="Turismo e Hotelaria">
                <option>Guia Tur√≠stico</option><option>Agente de Viagens</option><option>Recepcionista de Hotel</option><option>Camareira</option><option>Cozinheiro / Chef</option><option>Gar√ßom</option>
              </optgroup>
              <optgroup label="Artes e Comunica√ß√£o">
                <option>Jornalista</option><option>Publicit√°rio</option><option>Fot√≥grafo</option><option>Designer</option><option>M√∫sico</option><option>Artista Pl√°stico</option><option>Redator</option>
              </optgroup>
              <option value="OUTROS">OUTROS</option>
            </select>
          </div>
          <div id="prof_outros_wrap" class="hide"><label for="prof_outros">Outra profiss√£o</label><input id="prof_outros" placeholder="Especifique"></div>

          <div><label class="req" for="rg">RG</label><input id="rg"></div>
          <div><label class="req" for="rguf">UF do RG</label>
            <select id="rguf">
              <option value="">UF</option>
              <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option><option>CE</option><option>DF</option><option>ES</option><option>GO</option><option>MA</option><option>MT</option><option>MS</option><option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option><option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option><option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
            </select>
          </div>
          <div><label class="req" for="cpf">CPF</label><input id="cpf" placeholder="000.000.000-00"></div>
        </div>

        <!-- Auto declara√ß√£o ‚Äì Identidade de g√™nero (opcional) ‚Äì COMPLETO -->
        <div style="margin-top:8px">
          <label>Auto Declara√ß√£o ‚Äì Identidade de G√™nero (opcional)</label>
          <div class="inline">
            <label class="pill"><input type="radio" name="ident_genero_toggle" value="sim"> Sim</label>
            <label class="pill"><input type="radio" name="ident_genero_toggle" value="nao" checked> N√£o</label>
          </div>
          <div id="genero-opcoes" class="hide" style="margin-top:10px">
            <div class="chips">
              <label class="chip"><input type="checkbox" value="Mulher cisg√™nera"> Mulher cisg√™nera</label>
              <label class="chip"><input type="checkbox" value="Homem cisg√™nero"> Homem cisg√™nero</label>
              <label class="chip"><input type="checkbox" value="Mulher transg√™nera"> Mulher transg√™nera</label>
              <label class="chip"><input type="checkbox" value="Homem transg√™nero"> Homem transg√™nero</label>
              <label class="chip"><input type="checkbox" value="Travesti"> Travesti</label>
              <label class="chip"><input type="checkbox" value="N√£o-bin√°rie"> N√£o-bin√°rie</label>
              <label class="chip"><input type="checkbox" value="Prefiro n√£o dizer"> Prefiro n√£o dizer</label>
              <label class="chip">Outro: <input id="genero_outro" placeholder="especifique" style="width:220px"></label>
            </div>
          </div>
        </div>

        <h2 class="section-title" style="margin-top:14px">Endere√ßo</h2>
        <div class="grid cols-2">
          <div><label class="req" for="cep">CEP</label><input id="cep" placeholder="00000-000"></div>
          <div><label class="req" for="rua">Rua / Avenida</label><input id="rua"></div>
          <div><label class="req" for="num">N√∫mero</label><input id="num"></div>
          <div><label for="compl">Complemento</label><input id="compl"></div>
          <div><label class="req" for="bairro">Bairro</label><input id="bairro"></div>
          <div><label class="req" for="uf">UF</label>
            <select id="uf">
              <option value="">UF</option>
              <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option><option>CE</option><option>DF</option><option>ES</option><option>GO</option><option>MA</option><option>MT</option><option>MS</option><option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option><option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option><option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
            </select>
          </div>
          <div><label class="req" for="cidade">Cidade</label><input id="cidade"></div>
        </div>

        <h2 class="section-title" style="margin-top:14px">Contato</h2>
        <div class="grid cols-2">
          <div><label class="req" for="ddd">WhatsApp ‚Äî DDD</label><input id="ddd" placeholder="11"></div>
          <div><label class="req" for="cel">N√∫mero</label><input id="cel" placeholder="95675-9223"></div>
          <div><label class="req" for="email">E-mail</label><input id="email" type="email" placeholder="voce@email.com"></div>
        </div>
      </section>

      <!-- LGPD -->
      <section class="card callout">
        <p><strong>Envio direto ao WhatsApp Business de Juliano Garbuggio:</strong> ao prosseguir, o conte√∫do ser√° preparado para envio no aplicativo. Seus dados ser√£o tratados exclusivamente para fins de atendimento confidencial de seu caso, conforme a LGPD (Lei n¬∫ 13.709/2018) e o art. 25 do C√≥digo de √âtica da OAB (sigilo profissional). N√£o compartilhamos seus dados com terceiros al√©m do necess√°rio ao atendimento. Ao marcar a caixa abaixo, voc√™ declara estar ciente e concordar.</p>
        <label><input type="checkbox" id="lgpd" required> Li e concordo com o Aviso de Privacidade acima e autorizo o envio desta solicita√ß√£o via WhatsApp Business (+55 11 95675-9223).</label>
        <p id="lgpd-erro" class="err">√â necess√°rio concordar com o aviso de privacidade.</p>
      </section>

      <section class="card"><div class="btns"><button class="btn" id="btn-enviar" type="submit">Salvar + Enviar WhatsApp</button></div></section>
    </form>

    <footer>
      ¬© 2025 Juliano Garbuggio ‚Äì Advocacia & Consultoria ‚Äî <a href="https://www.julianogarbuggio.adv.br" target="_blank">www.julianogarbuggio.adv.br</a> ‚Äî <a href="https://wa.me/5511956759223" target="_blank">(11) 95675-9223</a><br>
      Juliano Garbuggio Sociedade Individual de Advocacia ‚Äî OAB/SP 54.923 | CNPJ 35.142.789/0001-08
    </footer>
  </div>

  <script>
    const $=s=>document.querySelector(s); const $$=s=>Array.from(document.querySelectorAll(s));
    const PLANILHA_URL = ""; // (opcional) WebApp para "blindado"

    const isMobile = () => /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);
    const isiOS    = () => /iPhone|iPad|iPod/i.test(navigator.userAgent);

    /* ------- util ------- */
    function gerarProtocolo(){ const d=new Date(), p=n=>String(n).padStart(2,'0'); return `JG-${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}-${Math.floor(1000+Math.random()*8999)}`; }
    function maskCPF(el){ let v=el.value.replace(/\D/g,'').slice(0,11); if(v.length>9) el.value=v.replace(/(\d{3})(\d{3})(\d{3})(\d{0,2})/,"$1.$2.$3-$4"); else if(v.length>6) el.value=v.replace(/(\d{3})(\d{3})(\d{0,3})/,"$1.$2.$3"); else if(v.length>3) el.value=v.replace(/(\d{3})(\d{0,3})/,"$1.$2"); else el.value=v; }
    function maskCEP(el){ let v=el.value.replace(/\D/g,'').slice(0,8); el.value = v.length>5 ? v.replace(/(\d{5})(\d{0,3})/,"$1-$2") : v; }
    function maskDDD(el){ el.value = el.value.replace(/\D/g,'').slice(0,2); }
    function maskFone(el){ el.value = el.value.replace(/\D/g,'').slice(0,9).replace(/(\d{5})(\d{4})/,"$1-$2"); }
    function maskData(el){ let v=el.value.replace(/\D/g,'').slice(0,8); if(v.length>=5) el.value=v.replace(/(\d{2})(\d{2})(\d{0,4})/,"$1/$2/$3"); else if(v.length>=3) el.value=v.replace(/(\d{2})(\d{0,2})/,"$1/$2"); else el.value=v; }

    function isValidCPF(str){ const cpf=(str||'').replace(/\D/g,''); if(!cpf||cpf.length!==11||/^([0-9])\1{10}$/.test(cpf)) return false; let s=0; for(let i=0;i<9;i++) s+=parseInt(cpf[i])*(10-i); let r=11-(s%11); const d1=(r>=10)?0:r; if(d1!==parseInt(cpf[9])) return false; s=0; for(let i=0;i<10;i++) s+=parseInt(cpf[i])*(11-i); r=11-(s%11); const d2=(r>=10)?0:r; return d2===parseInt(cpf[10]); }

    async function viaCEP(raw){ try{ const r=await fetch(`https://viacep.com.br/ws/${raw}/json/`); const j=await r.json(); return j && !j.erro ? j : null; }catch(e){ return null; } }
    async function autoCEP(cepEl, cidadeEl, ufEl, ruaEl, bairroEl, cidadeCompactEl){ 
      const raw=(cepEl.value||'').replace(/\D/g,''); 
      if(raw.length!==8) return; 
      const j=await viaCEP(raw); 
      if(cidadeEl) cidadeEl.value=''; if(ufEl) ufEl.value=''; if(ruaEl) ruaEl.value=''; if(bairroEl) bairroEl.value=''; if(cidadeCompactEl) cidadeCompactEl.value='';
      if(!j) return; 
      if(cidadeEl) cidadeEl.value=j.localidade||''; 
      if(ufEl) ufEl.value=j.uf||''; 
      if(ruaEl && j.logradouro) ruaEl.value=j.logradouro; 
      if(bairroEl && j.bairro) bairroEl.value=j.bairro; 
      if(cidadeCompactEl) cidadeCompactEl.value = `${j.localidade||''}/${j.uf||''}`.trim(); 
    }

    /* ------- mensagens ------- */
    function montarMsgSimples(d, protocolo){
      const identGeneros = (d.ident_genero_list||[]).join(', ');
      return [
        `üìù Novo cadastro ‚Äì *${d.nome}*`,
        '',
        `Nome: ${d.nome}`,
        d.nome_social?`Nome social: ${d.nome_social}`:'',
        d.pronomes?`Pronomes: ${d.pronomes}`:'',
        identGeneros?`Identidade(s) de g√™nero: ${identGeneros}${d.genero_outro? ' ‚Äî '+d.genero_outro:''}`:'',
        `CPF: ${d.cpf} | Celular: ${d.cel}`,
        d.email?`E-mail: ${d.email}`:'',
        `Cidade: ${d.cidadeuf} | CEP: ${d.cep}`,
        d.breve?`Motivo: ${d.breve}`:'',
        protocolo?`Protocolo: ${protocolo}`:'',
        '',
        'Li e concordo com o Aviso de Privacidade acima e autorizo o envio desta solicita√ß√£o via WhatsApp Business (+55 11 95675-9223).'
      ].filter(Boolean).join('\n');
    }

    function montarMsgCompleta(d, protocolo){ 
      const identGeneros = (d.ident_genero_list||[]).join(', ');
      return [
        `üìù Novo cadastro ‚Äì *${d.nome}*`,
        '',
        `Nome completo: ${d.nome}`,
        d.nome_social?`Nome social: ${d.nome_social}`:'',
        d.pronomes?`Pronomes: ${d.pronomes}`:'',
        identGeneros?`Identidade(s) de g√™nero: ${identGeneros}${d.genero_outro? ' ‚Äî '+d.genero_outro:''}`:'',
        `Nacionalidade: ${d.nacionalidade}${d.nacionalidade==='Outros'&&d.nac_outros?` (${d.nac_outros})`:''}`,
        `Data de nascimento: ${d.nasc}`,
        `Estado civil: ${d.ec}`,
        `Profiss√£o: ${d.prof}`,
        `RG: ${d.rg} - ESTADO: ${d.rguf}`,
        `CPF: ${d.cpf}`,
        `ENDERE√áO COMPLETO: ${d.rua}, n¬∫: ${d.num}, complemento: ${d.compl||''}`,
        `Bairro: ${d.bairro}`,
        `CEP: ${d.cep}`,
        `CIDADE: ${d.cidade}, ESTADO: ${d.uf}`,
        `WhatsApp COM DDD: ${d.ddd} ${d.cel}`,
        `E-mail: ${d.email}`,
        protocolo?`Protocolo: ${protocolo}`:'',
        '',
        'Li e concordo com o Aviso de Privacidade acima e autorizo o envio desta solicita√ß√£o via WhatsApp Business (+55 11 95675-9223).'
      ].filter(Boolean).join('\n');
    }

    /* ------- coleta/valida ------- */
    function coletaSimples(){ 
      const generoChecks = Array.from($('#genero-opcoes-s').querySelectorAll('input[type="checkbox"]:checked')).map(c=>c.value);
      return { 
        motivo: $('#motivo').value, 
        tipo: ($$('input[name="tipo"]').find(r=>r.checked)||{}).value||'‚Äî', 
        nome: $('#nome_s').value.trim(), 
        nome_social: $('#nome_social_s')?.value.trim()||'',
        pronomes: $('#pronomes_s')?.value.trim()||'',
        ident_genero_list: generoChecks,
        genero_outro: $('#genero_outro_s')?.value.trim()||'',
        cpf: $('#cpf_s').value.trim(), 
        cel: $('#cel_s').value.trim(), 
        email: $('#email_s').value.trim(), 
        cep: $('#cep_s').value.trim(), 
        cidadeuf: $('#cidadeuf_s').value.trim(), 
        breve: $('#breve').value.trim() 
      }; 
    }

    function coletaCompleta(){ 
      const generoChecks = Array.from($('#genero-opcoes').querySelectorAll('input[type="checkbox"]:checked')).map(c=>c.value);
      return { 
        motivo: $('#motivo').value, 
        nome: $('#nome').value.trim(), 
        nome_social: $('#nome_social')?.value.trim()||'', 
        pronomes: $('#pronomes')?.value.trim()||'', 
        ident_genero_list: generoChecks, 
        genero_outro: $('#genero_outro')?.value.trim()||'', 
        nacionalidade: $('#nacionalidade').value, 
        nac_outros: ($('#nac_outros')?.value||'').trim(), 
        nasc: $('#nasc').value.trim(), 
        ec: $('#ec').value, 
        prof: $('#prof').value==='OUTROS'?($('#prof_outros').value.trim()||'OUTROS'):$('#prof').value, 
        rg: $('#rg').value.trim(), 
        rguf: $('#rguf').value, 
        cpf: $('#cpf').value.trim(), 
        cep: $('#cep').value.trim(), 
        rua: $('#rua').value.trim(), 
        num: $('#num').value.trim(), 
        compl: $('#compl').value.trim(), 
        bairro: $('#bairro').value.trim(), 
        uf: $('#uf').value, 
        cidade: $('#cidade').value.trim(), 
        ddd: $('#ddd').value.trim(), 
        cel: $('#cel').value.trim(), 
        email: $('#email').value.trim() 
      }; 
    }

    function showErrors(list){ alert('Ajuste:\\n‚Ä¢ '+list.join('\\n‚Ä¢ ')); (document.activeElement||document.body).blur(); }
    function validaSimples(d){ 
      const falt=[]; 
      if(!$('#lgpd').checked){ $('#lgpd-erro').style.display='block'; return false; } 
      if(!d.nome) falt.push('NOME'); 
      if(!d.cpf) falt.push('CPF'); 
      if(!isValidCPF(d.cpf)) falt.push('CPF inv√°lido'); 
      if(!d.cel) falt.push('CELULAR'); 
      if(!/^\(\d{2}\)\s?\d{4,5}-\d{4}$/.test(d.cel) && d.cel.replace(/\\D/g,'').length!==11 && d.cel.replace(/\\D/g,'').length!==9) falt.push('WhatsApp inv√°lido'); 
      if(!/^\\d{5}-?\\d{3}$/.test(d.cep)) falt.push('CEP inv√°lido'); 
      if(!d.cidadeuf) falt.push('CIDADE/UF'); 
      if(falt.length){ showErrors(falt); return false; } 
      return true; 
    }
    function validaCompleta(d){ 
      const falt=[]; 
      if(!$('#lgpd').checked){ $('#lgpd-erro').style.display='block'; return false; } 
      ['nome','nasc','ec','prof','rg','rguf','cpf','cep','rua','num','bairro','uf','cidade','ddd','cel','email'].forEach(k=>{ if(!d[k]) falt.push(k.toUpperCase()); }); 
      if(!isValidCPF(d.cpf)) falt.push('CPF inv√°lido'); 
      if(!/^\\d{2}$/.test(d.ddd)) falt.push('DDD inv√°lido'); 
      if(!/^\\d{5}-?\\d{3}$/.test(d.cep)) falt.push('CEP inv√°lido'); 
      if(d.cel.replace(/\\D/g,'').length!==9) falt.push('WhatsApp inv√°lido'); 
      if(falt.length){ showErrors(falt); return false; } 
      return true; 
    }

    /* ------- modo simples x completo ------- */
    function normalize(s){ return (s||'').toLowerCase().normalize('NFD').replace(/\\p{Diacritic}/gu,''); }
    function toggleModo(){ 
      const m=normalize($('#motivo').value); 
      const full = (m==='procuracao' || m==='atualizacao'); 
      $('#sec-completo').classList.toggle('hide',!full); 
      $('#sec-simples').classList.toggle('hide',full); 
      $('#tipo_wrap').classList.toggle('hide',full); 
    }

    /* ------- WA + planilha ------- */
    function abrirWhatsApp(msg){ 
      const fone='5511956759223'; // FOR√áADO E √öNICO
      const base = isiOS() ? 'https://api.whatsapp.com/send' : 'https://wa.me';
      const url  = `${base}/${fone}?text=${encodeURIComponent(msg)}`;
      if (isMobile()) window.location.assign(url); else window.open(url,'_blank','noopener,noreferrer'); 
    }
    async function salvarNaPlanilha(payload){ 
      if(!PLANILHA_URL) return {ok:false}; 
      try{ const r=await fetch(PLANILHA_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}); return {ok:r.ok}; } catch(e){ return {ok:false}; } 
    }

    /* ------- binds ------- */
    function bind(){
      // m√°scaras (simples)
      $('#cpf_s').addEventListener('input',e=>maskCPF(e.target));
      $('#cel_s').addEventListener('input',e=>{ e.target.value=e.target.value.replace(/[^\\d()\\-\\s+]/g,''); });
      const cepS=$('#cep_s'); ['input','blur','change','keyup','touchend'].forEach(ev=>cepS.addEventListener(ev,()=>{ maskCEP(cepS); autoCEP(cepS,null,null,null,null,$('#cidadeuf_s')); }));

      // m√°scaras (completo)
      $('#cpf').addEventListener('input',e=>maskCPF(e.target));
      $('#nasc').addEventListener('input',e=>maskData(e.target));
      $('#ddd').addEventListener('input',e=>maskDDD(e.target));
      $('#cel').addEventListener('input',e=>maskFone(e.target));
      const cepC=$('#cep'); ['input','blur','change','keyup','touchend'].forEach(ev=>cepC.addEventListener(ev,()=>{ maskCEP(cepC); autoCEP(cepC,$('#cidade'),$('#uf'),$('#rua'),$('#bairro')); }));

      // nacionalidade "Outros"
      $('#nacionalidade').addEventListener('change',()=>{ $('#nac_outros_wrap').classList.toggle('hide', $('#nacionalidade').value!=='Outros'); });

      // profiss√£o OUTROS
      $('#prof').addEventListener('change',()=>{ $('#prof_outros_wrap').classList.toggle('hide', $('#prof').value!=='OUTROS'); });

      // Identifica√ß√£o complementar toggles
      $$('input[name="ident_comp"]').forEach(r=>r.addEventListener('change',()=>{ const show = r.checked && r.value==='sim'; $('#ident-comp-bloco').classList.toggle('hide', !show); }));
      $$('input[name="ident_comp_s"]').forEach(r=>r.addEventListener('change',()=>{ const show = r.checked && r.value==='sim'; $('#ident-comp-bloco-s').classList.toggle('hide', !show); }));

      // Identidade de g√™nero toggles
      $$('input[name="ident_genero_toggle"]').forEach(r=>r.addEventListener('change',()=>{ const show = r.checked && r.value==='sim'; $('#genero-opcoes').classList.toggle('hide', !show); }));
      $$('input[name="ident_genero_toggle_s"]').forEach(r=>r.addEventListener('change',()=>{ const show = r.checked && r.value==='sim'; $('#genero-opcoes-s').classList.toggle('hide', !show); }));

      // altern√¢ncia robusta (desktop + mobile)
      ['change','input','touchend','click','keyup','blur'].forEach(ev=>{
        document.getElementById('motivo').addEventListener(ev, toggleModo, {passive:true});
      });
      toggleModo();

      // SUBMIT
      $('#form').addEventListener('submit', async (e)=>{
        e.preventDefault();
        const full = !$('#sec-completo').classList.contains('hide');
        const protocolo = gerarProtocolo();
        if(full){
          const d=coletaCompleta(); if(!validaCompleta(d)) return;
          await salvarNaPlanilha({protocolo,tipo:'COMPLETO',dados:d,ts:new Date().toISOString()});
          abrirWhatsApp(montarMsgCompleta(d, protocolo));
        }else{
          const d=coletaSimples(); if(!validaSimples(d)) return;
          await salvarNaPlanilha({protocolo,tipo:'SIMPLES',dados:d,ts:new Date().toISOString()});
          abrirWhatsApp(montarMsgSimples(d, protocolo));
        }
      });
    }
    if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', bind); else bind();
  </script>
</body>
</html>
"""

# Embed the logo as base64 PNG
logo_path = root / "logobranca_juliano_garguggio.webp"
if logo_path.exists():
    im = Image.open(logo_path).convert("RGBA")
    # resize conservative
    max_w = 600
    if im.width > max_w:
        ratio = max_w / im.width
        im = im.resize((int(im.width*ratio), int(im.height*ratio)))
    tmp_png = root / "tmp_logo.png"
    im.save(tmp_png, format="PNG")
    b64 = base64.b64encode(tmp_png.read_bytes()).decode("ascii")
    data_uri = f"data:image/png;base64,{b64}"
else:
    # tiny transparent pixel
    data_uri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII="

html_final = user_html.replace('src="logo-juliano-garbuggio.png"', f'src="{data_uri}"')

out_path = root / "index_final_logo_embed.html"
out_path.write_text(html_final, encoding="utf-8")
out_path
